\documentclass{elsarticle}
\usepackage[utf8]{inputenc}
\usepackage{kpfonts}
\usepackage[labelfont=bf]{caption}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{stmaryrd}
\captionsetup[figure]{name=Fig. ,labelsep=period}

\newcommand{\choice}{|}
\newdefinition{definition}{Definition}
\newtheorem{notation}{Notation}
\newtheorem{theorem}{Theorem}
\newdefinition{example}{Example}
\newdefinition{running_example}{Running example}

\begin{document}

\section{Objects definition}

Let $\mathcal{N}_{A},~\mathcal{N}_{T},~\mathcal{N}_{\delta},~\mathcal{N}_{c}$ be mutually exclusive finite sets of atomic, structure, state names, and compartments, respectively.

\begin{definition}{Signature}

\begin{itemize} 
\item Atomic signature $\Sigma_{\mathtt{A}} \subseteq \mathcal{N}_{A} \times 2^{\mathcal{N}_{\delta}}$ represents allowed atomic names with association to state names. 
\item Structure signature $\Sigma_{\mathtt{T}} \subseteq \mathcal{N}_{T} \times 2^{\mathcal{N}_{A}}$ represents allowed structure names with association to atomic names. 
\end{itemize}
\end{definition}

\begin{example}
\item Atomic signature $(S, \{u, p\})$
\item Structure signature $(KaiC, \{S, T\})$
\end{example}

\begin{definition}{Atomic agent}

\begin{itemize}
\item Atomic agent $\mathtt{A}$ is a pair $(\mu, \delta)$ where $\mu \in \mathcal{N}_{A}$ is a name and $\delta \in \mathcal{N}_{\delta}$ is a state.

\item Equivalence: $\mathtt{A} \equiv \mathtt{A}' \Leftrightarrow \mu(\mathtt{A}) \equiv \mu(\mathtt{A}') \wedge \delta(\mathtt{A}) \equiv \delta(\mathtt{A}')$
\end{itemize}
\end{definition}

\begin{notation}
Let $\mathcal{A}$ be universe of all possible atomic agents.
\end{notation}

\begin{definition}{Structure agent}

\begin{itemize}
\item Structure agent $\mathtt{T}$ is a pair $(\mu, \gamma)$ where $\mu \in \mathcal{N}_{T}$ is a name and $\gamma \subseteq \mathcal{A}$ is a set of atomic agents called partial composition.

\item Equivalence: $\mathtt{T} \equiv \mathtt{T}' \Leftrightarrow \mu(\mathtt{T}) \equiv \mu(\mathtt{T}') \wedge \forall \mathtt{A} \in \gamma(\mathtt{T}) \exists \mathtt{A}' \in \gamma(\mathtt{T}') : \mathtt{A} \equiv \mathtt{A}' \wedge \\ \wedge \forall \mathtt{A}' \in \gamma(\mathtt{T}') \exists \mathtt{A} \in \gamma(\mathtt{T}) : \mathtt{A}' \equiv \mathtt{A}$.
\end{itemize}
\end{definition}

\begin{notation}
Let $\mathcal{T}$ be universe of all possible structure agents.
\end{notation}

\begin{definition}{Complex}

\begin{itemize}
\item Complex $\mathtt{X}$ is a pair $(\mu, \mathtt{com})$ where $\mu \in (\mathcal{A} \cup \mathcal{T})^n$ is a sequence and $\mathtt{com} \in \mathcal{N}_{c}$ is a compartment.

\item Let $\mathtt{X}, \mathtt{X}'$ be complexes. We denote length of sequence $\mu$ as $n = \mu(\mathtt{X})$ and $m = \mu(\mathtt{X}')$. 

\item Equivalence: $\mathtt{X} \equiv \mathtt{X}' \Leftrightarrow n \equiv m \wedge \exists $ permutation $ \mu'(\mathtt{X}')$ of $\mu(\mathtt{X}')$ such that $\forall i~\in~[1,~n]: \mu(\mathtt{X})_i \equiv \mu'(\mathtt{X}')_i$.
\end{itemize}
\end{definition}

\begin{notation}
Let $\mathcal{X}$ be universe of all possible complexes.
\end{notation}

\begin{definition}{Rule}

Rule $\mathtt{R}$ is a 5-tuple $(\chi, \omega, \mathtt{I}, \mathtt{map}, \mathtt{Indices})$ where:

\begin{itemize}
\item $\chi \in \mathcal{X}^n$ is a sequence of complexes,
\item $\omega \in (\mathcal{A} \cup \mathcal{T})^m$ is a sequence of atomic and structure agents,
\item $\mathtt{I} \in \{ 1, \ldots, n \}$ is an index determining start of right-hand-side,
\item $\mathtt{map} \in \mathbb{N}^m$ is an index map between $\omega$ and $\chi$,
\item $\mathtt{Indices} \subseteq (\{-\} \cup \mathbb{N})^2$ is an index map between agents from left- and right-hand side
\end{itemize}

where $n, m \in \mathbb{N}$.
\end{definition}

\begin{definition}{Reaction}

Reaction $\mathtt{r}$ is a pair $(\mathtt{seq}, \mathtt{I})$ where:

\begin{itemize}
\item $\mathtt{seq} \in \mathcal{X}^n$ is a sequence of complexes,
\item $\mathtt{I} \in \{ 1, \ldots, n \}$ is an index determining start of right-hand-side
\end{itemize}

where $n, m \in \mathbb{N}$.
\end{definition}

\section{Syntax}

\begin{definition}
\textit{Grammar.}

\begin{center}
\begin{tabular}{ l l }
atomic expression & $\mathtt{a} ::= \mu\{s\} ~|~ ? \mu$\\
 & $\mu ::= n \in \mathcal{N}_{A}$ \\
 & $s ::= n \in \mathcal{N}_{\delta}$\\
 & \\
structure expression & $\mathtt{t} ::= \mu(\gamma) ~|~ \mu$\\
 & $\gamma ::= \mathtt{a}_1, \ldots, \mathtt{a}_m$ \\
 & $\mu ::= n \in \mathcal{N}_{T}$\\
 & \\
complex expression & $\Gamma ::= \alpha_1~.~\ldots~.~\alpha_k :: c$\\
 & $\alpha_i ::= \mathtt{a} ~|~ \mathtt{t}$\\
 & $c ::= n \in \mathcal{N}_{c}$\\
 & \\
rule & $\mathtt{R} ::= \Gamma_1 + \ldots + \Gamma_n \Rightarrow \Gamma_{n+1} + \ldots + \Gamma_m $
\end{tabular}

\end{center}
where $m,n \in \mathbb{N}_0 \wedge m + n \neq 0$ and $k \in \mathbb{N}$.
\end{definition}

\section{Semantic function}

Semantic function $\mathtt{F}$ gives semantical meaning to rules and objects written in BCSL syntax. It is defined recursivelly according to context given as argument:

\begin{center}
\begin{tabular}{ r c l}
$\mathtt{F} \llbracket ~\mu~ \rrbracket$ & = &
		$\begin{cases}
		\mathtt{A}(\mu, \emptyset) ~\ldots~ \mu \in \Sigma_{A}\\
		\mathtt{T}(\mu, \epsilon) ~\ldots~ \mu \in \Sigma_{T}\\
		\end{cases}
		$\\
 & & \\
$\mathtt{F} \llbracket ~\mu\{s\}~ \rrbracket$ & = & $\mathtt{A}(\mu, s)$\\
 & & \\
$\mathtt{F} \llbracket ~\mu(\mathtt{a}_1, \ldots, \mathtt{a}_n)~ \rrbracket$ & = &
$\mathtt{T}(\mu, \{ \mathtt{F} \llbracket \mathtt{a}_1 \rrbracket, \ldots, \mathtt{F} \llbracket \mathtt{a}_n \rrbracket \})$\\
 & & \\
$\mathtt{F} \llbracket ~\alpha_1~.~\ldots~.~\alpha_n :: c~ \rrbracket$ & = &
$\mathtt{X}((\mathtt{F} \llbracket ~\alpha_1~ \rrbracket, \ldots, \mathtt{F} \llbracket ~\alpha_n~ \rrbracket), c)$\\
 & & \\
$\mathtt{F} \llbracket ~\Gamma_1 + \ldots + \Gamma_n \Rightarrow \Gamma_{n+1} + \ldots + \Gamma_m~ \rrbracket$ & = &
$(\chi, \omega, \mathtt{I}, \mathtt{map}, \mathtt{Indices})$~ such that:\\
\end{tabular}
\end{center}

\begin{center}
\begin{itemize}
\item $\chi = (\mathtt{F} \llbracket ~\Gamma_1~ \rrbracket, \ldots, \mathtt{F} \llbracket ~\Gamma_n~ \rrbracket, \mathtt{F} \llbracket ~\Gamma_{n+1}~ \rrbracket, \ldots, \mathtt{F} \llbracket ~\Gamma_m~ \rrbracket)$,
\item $\omega = \bullet_{\mathtt{X} \in \chi} (\mu(\mathtt{X}))$ !!!
\item $\mathtt{I} = n$
\item $\mathtt{map} = (J_1, \ldots, J_m): J_i = \sum_{y=1}^{i} | \mu(\chi_i) |$
\item $\mathtt{Indices} = \{~ (i,j) ~|~ i \in [1, \mathtt{map}(\mathtt{I})] \wedge j \in [\mathtt{map}(\mathtt{I}), |\omega|] \wedge |i-j| \equiv \mathtt{map}(\mathtt{I})~\}\cup \{~ (i, -) ~|~ i \in [k, \mathtt{map}(\mathtt{I})] \wedge k = |~ \{ \mathtt{map}(\mathtt{I}) + 1, \ldots, | \alpha | \} ~| ~\} \cup \{~ (-, j) ~|~ j \in [k, |\alpha|] \wedge k = 2 * \mathtt{map}(\mathtt{I}) ~\}$ !!! ordered set
\end{itemize}
\end{center}

\section{Additional definitons}

\begin{definition}{Tuples concatenation}

Let $T = (\tau_1, \ldots, \tau_n)$ be sequence of tuples where $\tau_i = (x_1^i, \ldots, x_m^i)$. Concatenation of sequence of tuples $\bullet_{\tau \in T} (\tau)$ is defined as:

\begin{center}
$\bullet_{\tau \in T} (\tau) = (x_1^1, \ldots, x_m^1, x_1^2, \ldots, x_l^2, \ldots \ldots, x_1^n, \ldots, x_k^n)$.
\end{center}
\end{definition}

\begin{definition}{Difference of partial compositions}

Let $\gamma, \gamma'$ be two partial compositions. We define difference of these two sets on names of its atomic agents as following:

\begin{center}
$\gamma \ominus \gamma' \Leftrightarrow \{ \mu_\alpha ~|~ \exists \mathtt{A}: (\mathtt{A} \in \gamma \wedge \mu(\mathtt{A}) \equiv \mu_\alpha ) \wedge \not\exists \mathtt{A}': (\mathtt{A}' \in \gamma' \wedge \mu(\mathtt{A}') \equiv \mu_\alpha)\}$
\end{center}
\end{definition}

\begin{definition}{Difference of partial composition and structure signature}

Let $\mathtt{T}$ be a structure agent. Next, let $\gamma(\mathtt{T})$ be its partial composition and $\Sigma_T(\mathtt{T})$ appropriate signature. We define difference of these two sets on names of atomic agents as following:

\begin{center}
$\gamma(\mathtt{T}) \ominus \Sigma_T(\mathtt{T}) \Leftrightarrow \{ \mu_\Sigma ~|~ \mu_\Sigma \in \Sigma_T(\mathtt{T}) \wedge \not\exists \mathtt{A}: (\mathtt{A} \in \gamma(\mathtt{T}) \wedge \mu(\mathtt{A}) \equiv \mu_\Sigma)\}$
\end{center}
\end{definition}

\section{Ground forms}

Ground form represents appending context to agents according to signature (we assume signature is always available and therefor we omit it in ground form function arguments).

Objects are transformed to their ground forms by ground form function $\mathcal{G}$ defined as following:


\begin{center}
\begin{tabular}{ r c l }
Object & basic form & ground form \\
\hline
 & & \\
$\mathtt{A}$ & $\mathcal{G}((\mu, \epsilon))$ & $\{~ (\mu, \delta) ~|~ \delta \in \Sigma_A(\mu) ~\}$\\
 & $\mathcal{G}((\mu, \delta))$ & $\{~(\mu, \delta) ~\}$\\
 & & \\
 \hline
 & & \\
$\mathtt{T}$ & $\mathcal{G}((\mu, \gamma))$ & $\{~ (\mu, \gamma_\alpha) ~|~ \gamma_\alpha \equiv \gamma \cup \gamma_\Sigma \wedge \gamma_\Sigma = \{~ \mathtt{A}_1, \ldots, \mathtt{A}_n ~\} \wedge$\\
 & & $\wedge~ \mathtt{A}_i \in \mathcal{G}((\mu, \emptyset)) \wedge \mu \in \gamma \ominus \Sigma_T(\mathtt{T}) ~\}$ \\
 & & \\
 \hline
 & & \\
pair of & $\mathcal{G}((\beta, \beta'))$ & $\{~ (\beta_\alpha, \beta_\alpha') ~|~ \beta_\alpha \in \mathcal{G}(\beta) \wedge \beta'_\alpha \in \mathcal{G}(\beta') \wedge$\\
agents & & $\wedge~ \gamma(\beta_\alpha) \ominus \gamma(\beta) \equiv \gamma(\beta'_\alpha) \ominus \gamma(\beta') ~\} $ \\
 & & \\
 \hline
 & & \\
$\mathtt{R}$ & $\mathcal{G}(\mathtt{R})$ & $\{~ \bigotimes \mathcal{G}(\mathtt{Indices})^* ~\}$ \\
 & $\mathcal{G}(\mathtt{Indices})$ & $(~\mathcal{G}(\alpha(i), \alpha(j)) ~|~ (i,j) \in \mathtt{Indices})$\\
 
\end{tabular}
\end{center}

Next, we need reassemble produced tuples by concantenation.

\begin{center}
$\mathtt{reassemble}(\mathcal{G}(\mathtt{R})) = \{~  T ~|~ T = \bullet_{\tau \in \iota} (\tau) \wedge \iota \in \mathcal{G}(\mathtt{R}) ~\}$
\end{center}

\section{Generating reactions}

Given a rule $\mathtt{R}$, we can produce appropriate reactions using ground forms and reassembly:

\begin{center}
$\mathtt{Reactions} = \{~ \mathtt{r}(\mathtt{seq}, \mathtt{I}) ~|~ T \in \mathtt{reassemble}(\mathcal{G}(\mathtt{R})) \wedge seq = (\mathtt{X}(T(1, \ldots, i_1), \mathtt{com}(\chi(i_1))), \mathtt{X}(T(i_1 + 1, \ldots, i_2), \mathtt{com}(\chi(i_2))), \ldots, \mathtt{X}(T(i_{n-1}+1, \ldots, i_n), \mathtt{com}(\chi(i_n)))) \wedge \mathtt{I} \in \mathtt{R} \wedge \chi \in \mathtt{R} ~\}$
\end{center}

\section{Vectorized model}

\begin{definition}{Vectorized model}

Vectorized model $\mathcal{M}$ is a triple $(\mathcal{R}, \nu, \pi)$ such that $\mathcal{R} \subseteq \mathbb{Z}^n$ is set of vector reactions, $\nu \in \mathbb{N}_0^n$ is initial vector state, and $\pi \in \chi^n$ is vector of reference complexes for some $n \in \mathbb{N}$.
\end{definition}

\begin{notation}
We denote $N(\nu) ~\emph{iff}~ \forall i \in \nu: i \in \mathbb{N}_0$.
\end{notation}

\begin{definition}{Vector reaction application}

Vector reaction application $\rho \subseteq \mathbb{N}_0^n \times \mathbb{Z}^n \times \mathbb{N}_0^n$ such that $(\upsilon, \mathtt{r}, \mathtt{u}) \in \rho$ $\Leftrightarrow$ $result = \{~ u ~|~ u \equiv \upsilon + \mathtt{r} \wedge N(u) \wedge  ~\}$
\end{definition}

\section{Production of model}

+ unique complexes

Let $(\mathtt{S}, \mathtt{R}, \Sigma)$ be a rule-based model.

\end{document}